<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü•ã Tier Dojo - AI Battle Arena</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #fff;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .subtitle {
            text-align: center;
            color: #888;
            margin-bottom: 30px;
        }

        .battle-config {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 20px;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
        }

        .fighter-select {
            text-align: center;
        }

        .fighter-select h3 {
            margin-bottom: 15px;
            color: #aaa;
        }

        .fighter-select select {
            font-size: 1.2rem;
            padding: 10px 20px;
            border-radius: 10px;
            border: 2px solid #444;
            background: #222;
            color: #fff;
            cursor: pointer;
        }

        .vs {
            font-size: 2rem;
            font-weight: bold;
            color: #ff6b6b;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 30px;
        }

        button {
            padding: 12px 25px;
            font-size: 1rem;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }

        .btn-fight {
            background: linear-gradient(135deg, #ff6b6b, #ee5a5a);
            color: white;
        }

        .btn-fight:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(255, 107, 107, 0.4);
        }

        .btn-tournament {
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
            color: white;
        }

        .btn-stop {
            background: linear-gradient(135deg, #666, #444);
            color: white;
        }

        .config-options {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-bottom: 20px;
        }

        .config-options label {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .config-options input {
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #444;
            background: #222;
            color: #fff;
            width: 80px;
        }

        .arena {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 30px;
        }

        .board-container {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
        }

        .mini-board {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 3px;
            max-width: 400px;
            margin: 0 auto;
        }

        .mini-cell {
            aspect-ratio: 1;
            background: #1a1a2e;
            border-radius: 50%;
            transition: background 0.2s;
        }

        .mini-cell.player1 {
            background: radial-gradient(circle at 30% 30%, #ffeb3b, #ffc107);
        }

        .mini-cell.player2 {
            background: radial-gradient(circle at 30% 30%, #ff5252, #d32f2f);
        }

        .stats-panel {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
        }

        .stats-panel h3 {
            margin-bottom: 20px;
            text-align: center;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #333;
        }

        .stat-value {
            font-weight: bold;
            color: #4ecdc4;
        }

        .battle-log {
            margin-top: 30px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            max-height: 300px;
            overflow-y: auto;
        }

        .battle-log h3 {
            margin-bottom: 15px;
        }

        .log-entry {
            padding: 5px 0;
            font-family: monospace;
            font-size: 0.9rem;
            color: #aaa;
        }

        .log-entry.winner1 {
            color: #ffeb3b;
        }

        .log-entry.winner2 {
            color: #ff5252;
        }

        .log-entry.draw {
            color: #888;
        }

        .progress-bar {
            height: 10px;
            background: #333;
            border-radius: 5px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4ecdc4, #44a08d);
            transition: width 0.3s;
        }

        .current-game {
            text-align: center;
            padding: 10px;
            color: #888;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ü•ã Tier Dojo</h1>
        <p class="subtitle">AI Battle Arena - Lasse verschiedene Tiere gegeneinander k√§mpfen!</p>

        <div class="battle-config">
            <div class="fighter-select">
                <h3>üü° K√§mpfer 1 (Gelb)</h3>
                <select id="fighter1">
                    <option value="snail">üêå Schnecke (MCTS 50)</option>
                    <option value="turtle">üê¢ Schildkr√∂te (MCTS 100)</option>
                    <option value="rabbit">üê∞ Hase (MCTS 200)</option>
                    <option value="cat">üê± Katze (MCTS 500)</option>
                    <option value="fox" selected>ü¶ä Fuchs (AB Tiefe 4)</option>
                    <option value="wolf">üê∫ Wolf (AB Tiefe 6)</option>
                    <option value="owl">ü¶â Eule (AB Tiefe 8)</option>
                    <option value="dragon">üêâ Drache (AB Tiefe 10)</option>
                </select>
            </div>
            <div class="vs">‚öîÔ∏è VS ‚öîÔ∏è</div>
            <div class="fighter-select">
                <h3>üî¥ K√§mpfer 2 (Rot)</h3>
                <select id="fighter2">
                    <option value="snail">üêå Schnecke (MCTS 50)</option>
                    <option value="turtle">üê¢ Schildkr√∂te (MCTS 100)</option>
                    <option value="rabbit">üê∞ Hase (MCTS 200)</option>
                    <option value="cat">üê± Katze (MCTS 500)</option>
                    <option value="fox">ü¶ä Fuchs (AB Tiefe 4)</option>
                    <option value="wolf">üê∫ Wolf (AB Tiefe 6)</option>
                    <option value="owl">ü¶â Eule (AB Tiefe 8)</option>
                    <option value="dragon" selected>üêâ Drache (AB Tiefe 10)</option>
                </select>
            </div>
        </div>

        <div class="config-options">
            <label>
                Anzahl Spiele:
                <input type="number" id="numGames" value="10" min="1" max="1000">
            </label>
            <label>
                Verz√∂gerung (ms):
                <input type="number" id="delay" value="50" min="0" max="1000">
            </label>
        </div>

        <div class="controls">
            <button class="btn-fight" onclick="startBattle()">‚öîÔ∏è Kampf starten!</button>
            <button class="btn-tournament" onclick="runTournament()">üèÜ Turnier (alle vs alle)</button>
            <button class="btn-stop" onclick="stopBattle()">‚èπÔ∏è Stopp</button>
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="progress" style="width: 0%"></div>
        </div>
        <div class="current-game" id="currentGame">Warte auf Start...</div>

        <div class="arena">
            <div class="board-container">
                <div class="mini-board" id="board"></div>
            </div>

            <div class="stats-panel">
                <h3>üìä Statistiken</h3>
                <div class="stat-row">
                    <span>Spiele gesamt:</span>
                    <span class="stat-value" id="totalGames">0</span>
                </div>
                <div class="stat-row">
                    <span>üü° Siege K√§mpfer 1:</span>
                    <span class="stat-value" id="wins1">0</span>
                </div>
                <div class="stat-row">
                    <span>üî¥ Siege K√§mpfer 2:</span>
                    <span class="stat-value" id="wins2">0</span>
                </div>
                <div class="stat-row">
                    <span>ü§ù Unentschieden:</span>
                    <span class="stat-value" id="draws">0</span>
                </div>
                <div class="stat-row">
                    <span>√ò Z√ºge pro Spiel:</span>
                    <span class="stat-value" id="avgMoves">0</span>
                </div>
                <div class="stat-row">
                    <span>√ò Zeit pro Spiel:</span>
                    <span class="stat-value" id="avgTime">0 ms</span>
                </div>
            </div>
        </div>

        <div class="battle-log">
            <h3>üìú Kampfprotokoll</h3>
            <div id="log"></div>
        </div>
    </div>

    <script src="js/game.js"></script>
    <script src="js/mcts.js"></script>
    <script src="js/alphabeta.js"></script>
    <script src="js/animals.js"></script>
    <script>
        let running = false;
        let stats = { wins1: 0, wins2: 0, draws: 0, totalMoves: 0, totalTime: 0 };

        function initBoard() {
            const board = document.getElementById('board');
            board.innerHTML = '';
            // Render from top to bottom (row 5 to 0)
            for (let row = 5; row >= 0; row--) {
                for (let col = 0; col < 7; col++) {
                    const cell = document.createElement('div');
                    cell.className = 'mini-cell';
                    cell.id = `cell-${col}-${row}`;
                    board.appendChild(cell);
                }
            }
        }

        function updateBoard(gameState) {
            for (let col = 0; col < 7; col++) {
                for (let row = 0; row < 6; row++) {
                    const cell = document.getElementById(`cell-${col}-${row}`);
                    cell.className = 'mini-cell';
                    const value = gameState.getCell(col, row);
                    if (value === 1) cell.classList.add('player1');
                    else if (value === 2) cell.classList.add('player2');
                }
            }
        }

        function updateStats() {
            const total = stats.wins1 + stats.wins2 + stats.draws;
            document.getElementById('totalGames').textContent = total;
            document.getElementById('wins1').textContent = `${stats.wins1} (${total ? ((stats.wins1 / total) * 100).toFixed(1) : 0}%)`;
            document.getElementById('wins2').textContent = `${stats.wins2} (${total ? ((stats.wins2 / total) * 100).toFixed(1) : 0}%)`;
            document.getElementById('draws').textContent = stats.draws;
            document.getElementById('avgMoves').textContent = total ? (stats.totalMoves / total).toFixed(1) : 0;
            document.getElementById('avgTime').textContent = total ? (stats.totalTime / total).toFixed(0) + ' ms' : '0 ms';
        }

        function addLog(message, type = '') {
            const log = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = 'log-entry ' + type;
            entry.textContent = message;
            log.insertBefore(entry, log.firstChild);
        }

        async function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        async function playGame(ai1, ai2, delay) {
            const game = new GameState();
            const startTime = performance.now();

            while (!game.gameOver && running) {
                const currentAI = game.currentPlayer === 1 ? ai1 : ai2;
                const move = currentAI.findBestMove(game);
                game.makeMove(move);

                if (delay > 0) {
                    updateBoard(game);
                    await sleep(delay);
                }
            }

            updateBoard(game);
            const endTime = performance.now();

            return {
                winner: game.winner,
                moves: game.moveCount,
                time: endTime - startTime
            };
        }

        async function startBattle() {
            if (running) return;
            running = true;

            const fighter1Id = document.getElementById('fighter1').value;
            const fighter2Id = document.getElementById('fighter2').value;
            const numGames = parseInt(document.getElementById('numGames').value);
            const delay = parseInt(document.getElementById('delay').value);

            const animal1 = getAnimal(fighter1Id);
            const animal2 = getAnimal(fighter2Id);

            stats = { wins1: 0, wins2: 0, draws: 0, totalMoves: 0, totalTime: 0 };
            document.getElementById('log').innerHTML = '';
            initBoard();

            addLog(`ü•ã ${animal1.emoji} ${animal1.name} vs ${animal2.emoji} ${animal2.name} - ${numGames} Spiele`);
            addLog(`‚öñÔ∏è Spieler wechseln jede Runde die Farbe f√ºr Fairness`);

            for (let i = 0; i < numGames && running; i++) {
                document.getElementById('currentGame').textContent = `Spiel ${i + 1} von ${numGames}...`;
                document.getElementById('progress').style.width = ((i / numGames) * 100) + '%';

                // Alternate who plays first for fair testing
                const swapped = (i % 2 === 1);
                const ai1 = createAI(swapped ? fighter2Id : fighter1Id);
                const ai2 = createAI(swapped ? fighter1Id : fighter2Id);

                const result = await playGame(ai1, ai2, delay);

                // Map result back to original fighters
                let actualWinner = result.winner;
                if (swapped && result.winner !== null) {
                    actualWinner = result.winner === 1 ? 2 : 1;
                }

                if (actualWinner === 1) {
                    stats.wins1++;
                    const color = swapped ? 'üî¥' : 'üü°';
                    addLog(`Spiel ${i + 1}: ${animal1.emoji} gewinnt ${color} in ${result.moves} Z√ºgen`, 'winner1');
                } else if (actualWinner === 2) {
                    stats.wins2++;
                    const color = swapped ? 'üü°' : 'üî¥';
                    addLog(`Spiel ${i + 1}: ${animal2.emoji} gewinnt ${color} in ${result.moves} Z√ºgen`, 'winner2');
                } else {
                    stats.draws++;
                    addLog(`Spiel ${i + 1}: Unentschieden nach ${result.moves} Z√ºgen`, 'draw');
                }

                stats.totalMoves += result.moves;
                stats.totalTime += result.time;
                updateStats();

                await sleep(10);
            }

            document.getElementById('progress').style.width = '100%';
            document.getElementById('currentGame').textContent = 'Fertig!';
            addLog(`üèÅ Endergebnis: ${animal1.emoji} ${stats.wins1} - ${stats.wins2} ${animal2.emoji} (${stats.draws} Unentschieden)`);
            running = false;
        }

        async function runTournament() {
            if (running) return;
            running = true;

            const animals = ['snail', 'turtle', 'rabbit', 'cat', 'fox', 'wolf', 'owl', 'dragon'];
            const numGames = parseInt(document.getElementById('numGames').value);
            const scores = {};
            animals.forEach(a => scores[a] = { wins: 0, losses: 0, draws: 0 });

            document.getElementById('log').innerHTML = '';
            addLog('üèÜ TURNIER GESTARTET - Jeder gegen Jeden!');

            const totalMatches = (animals.length * (animals.length - 1)) / 2;
            let matchCount = 0;

            for (let i = 0; i < animals.length && running; i++) {
                for (let j = i + 1; j < animals.length && running; j++) {
                    matchCount++;
                    const animal1 = getAnimal(animals[i]);
                    const animal2 = getAnimal(animals[j]);
                    // These are just for display, actual AIs created per game
                    const _ = null;

                    document.getElementById('currentGame').textContent =
                        `Match ${matchCount}/${totalMatches}: ${animal1.emoji} vs ${animal2.emoji}`;
                    document.getElementById('progress').style.width = ((matchCount / totalMatches) * 100) + '%';

                    let w1 = 0, w2 = 0, d = 0;
                    for (let g = 0; g < numGames && running; g++) {
                        // Alternate who goes first for fair testing
                        const swapped = (g % 2 === 1);
                        const gameAi1 = createAI(swapped ? animals[j] : animals[i]);
                        const gameAi2 = createAI(swapped ? animals[i] : animals[j]);

                        const result = await playGame(gameAi1, gameAi2, 0);

                        let actualWinner = result.winner;
                        if (swapped && result.winner !== null) {
                            actualWinner = result.winner === 1 ? 2 : 1;
                        }

                        if (actualWinner === 1) w1++;
                        else if (actualWinner === 2) w2++;
                        else d++;
                        updateBoard(new GameState()); // Clear
                        await sleep(1);
                    }

                    scores[animals[i]].wins += w1;
                    scores[animals[i]].losses += w2;
                    scores[animals[i]].draws += d;
                    scores[animals[j]].wins += w2;
                    scores[animals[j]].losses += w1;
                    scores[animals[j]].draws += d;

                    addLog(`${animal1.emoji} ${w1} - ${w2} ${animal2.emoji} (${d} draws)`);
                }
            }

            // Final standings
            addLog('');
            addLog('üèÜ ENDERGEBNIS:');
            const standings = animals
                .map(a => ({ id: a, ...getAnimal(a), ...scores[a], points: scores[a].wins * 3 + scores[a].draws }))
                .sort((a, b) => b.points - a.points);

            standings.forEach((s, i) => {
                addLog(`${i + 1}. ${s.emoji} ${s.name}: ${s.points} Punkte (${s.wins}W/${s.draws}D/${s.losses}L)`);
            });

            document.getElementById('currentGame').textContent = 'Turnier beendet!';
            running = false;
        }

        function stopBattle() {
            running = false;
            document.getElementById('currentGame').textContent = 'Gestoppt';
        }

        // Initialize
        initBoard();
    </script>
</body>

</html>